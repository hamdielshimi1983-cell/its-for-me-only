<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zoho QnA - e& AI Assistant</title>
  <style>
    :root{
      --primary:#0066cc;
      --accent:#ff7a59;
      --bg:#f5f7fb;
      --card:#ffffff;
      --muted:#6b7280;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family: "Tajawal", "Tahoma", Arial, sans-serif;background:var(--bg);color:#0b1220;line-height:1.6}
    .container{max-width:1100px;margin:28px auto;padding:18px}
    .top{display:flex;gap:18px;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:44px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 6px 20px rgba(10,20,40,0.06);padding:18px}
    h1{margin:0;font-size:20px}
    .ai-badge{display:inline-block;background:#16a34a;color:white;padding:4px 10px;border-radius:6px;font-size:11px;margin-right:8px;font-weight:600}
    .layout{display:grid;grid-template-columns: 1fr 380px;gap:18px;margin-top:14px}
    @media(max-width:960px){.layout{grid-template-columns:1fr;}}
    label{display:block;font-weight:700;margin-top:10px;font-size:14px}
    select,textarea,input{width:100%;padding:10px;border-radius:10px;border:1px solid #e8eef8;background:#fbfdff;font-family:inherit}
    textarea{min-height:110px;resize:vertical;font-size:14px}
    .btn{background:var(--primary);color:#fff;border:none;padding:11px 16px;border-radius:10px;cursor:pointer;font-weight:600;font-size:14px;transition:all 0.2s}
    .btn:hover{background:#0052a3;transform:translateY(-1px)}
    .btn:disabled{opacity:0.6;cursor:not-allowed}
    .result{white-space:pre-wrap;margin-top:12px;background:#fcfeff;padding:16px;border-radius:10px;border:1px solid #eef6ff;line-height:1.8;font-size:14px}
    .result h1{font-size:22px;margin:0 0 12px 0;color:#003366}
    .result h2{font-size:18px;margin:20px 0 10px 0;color:#0066cc}
    .result h3{font-size:16px;margin:16px 0 8px 0;color:#333}
    .sources{margin-top:10px;font-size:13px}
    .ai-powered{background:#e0f2fe;padding:10px;border-radius:6px;margin-bottom:10px;border:1px solid #bae6fd}
    .examples{margin-top:16px}
    .example-btn{display:block;width:100%;text-align:right;background:#f8fafc;border:1px solid #e8eef8;padding:10px;border-radius:8px;margin-top:8px;cursor:pointer;transition:all 0.2s;font-size:13px;color:#333}
    .example-btn:hover{background:#e8eef8;border-color:#cbd5e1}
  </style>
</head>
<body>
  <div class="container">
    <div class="top">
      <div class="brand">
        <img src="https://ik.imagekit.io/xtj3m9hth/image-remove1bg-preview%20(3).png?updatedAt=1761220721716" alt="e& logo">
        <img src="https://ik.imagekit.io/weo7pcw8v/image-removebg-preview%20(3).png?updatedAt=1761788895997" alt="Zoho logo" style="height:36px">
        <div>
          <h1>
            <span class="ai-badge">ğŸ¤– AI</span>
            Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Zoho Ø§Ù„Ø°ÙƒÙŠ
          </h1>
          <div style="color:var(--muted);font-size:13px;margin-top:4px">
            Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ â€¢ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø´Ø§Ù…Ù„Ø© ÙˆÙ…Ø®ØµØµØ©
          </div>
        </div>
      </div>
    </div>

    <div class="layout">
      <!-- Main Content -->
      <div>
        <div class="card">
          <label>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø§Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <select id="industry">
            <option value="">Ø¹Ø§Ù… / ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option>
            <option value="retail">Ø§Ù„ØªØ¬Ø²Ø¦Ø© ÙˆØ§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</option>
            <option value="logistics">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ©</option>
            <option value="fintech">Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option>
            <option value="tourism">Ø§Ù„Ø³ÙŠØ§Ø­Ø© ÙˆØ§Ù„Ø¶ÙŠØ§ÙØ©</option>
            <option value="realestate">Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¥Ù†Ø´Ø§Ø¡Ø§Øª</option>
            <option value="health">Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ©</option>
          </select>

          <label>Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <select id="scenario">
            <option value="">Ø¹Ø§Ù…</option>
            <option value="discovery">Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª</option>
            <option value="objection">Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø¹ØªØ±Ø§Ø¶</option>
            <option value="value">ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ù‚ÙŠÙ…Ø©</option>
            <option value="recommend">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨</option>
            <option value="workflow">Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© ØªØ´ØºÙŠÙ„ÙŠØ©</option>
            <option value="closing">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙÙ‚Ø©</option>
          </select>

          <label>Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªÙŠ ÙŠÙˆØ§Ø¬Ù‡Ù‡Ø§</label>
          <textarea id="question" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø¯ÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙÙŠ Ù…ØªØ§Ø¬Ø±ÙŠ Ø§Ù„Ø«Ù„Ø§Ø«Ø©"></textarea>

          <div style="display:flex;gap:10px;margin-top:12px">
            <button id="askBtn" class="btn">ğŸ” Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„</button>
            <button id="clearBtn" class="btn" style="background:#64748b">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
          </div>

          <div id="result" class="result" style="display:none"></div>
          <div id="sources" class="sources"></div>
        </div>
      </div>

      <!-- Sidebar -->
      <div>
        <div class="card">
          <h3 style="margin:0 0 12px 0;font-size:16px">ğŸ’¡ Ø£Ù…Ø«Ù„Ø© Ø³Ø±ÙŠØ¹Ø©</h3>
          <div class="examples">
            <button class="example-btn" data-q="Ù„Ø¯ÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙÙŠ Ù…ØªØ§Ø¬Ø±ÙŠ">
              ğŸ“¦ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            </button>
            <button class="example-btn" data-q="Ù„ÙŠØ³ Ù„Ø¯ÙŠ Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙ…Ù„ÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ©">
              ğŸ‘¥ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙ…Ù„ÙŠÙ†
            </button>
            <button class="example-btn" data-q="Ù…Ø§ Ù‡Ùˆ Zoho CRM ÙˆÙ…Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø£Ù† ÙŠÙØ¹Ù„ØŸ">
              â„¹ï¸ Ù…Ø§ Ù‡Ùˆ Zoho CRMØŸ
            </button>
            <button class="example-btn" data-q="Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙ‚ÙˆÙ„ Ø£Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹Ù‚Ø¯ Ø¬Ø¯Ø§Ù‹">
              âš ï¸ Ø§Ø¹ØªØ±Ø§Ø¶: Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹Ù‚Ø¯
            </button>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <h3 style="margin:0 0 8px 0;font-size:16px">ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
          <ul style="color:var(--muted);padding-right:18px;font-size:13px;line-height:1.8;margin:8px 0">
            <li>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØ­Ù„Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
            <li>ÙŠÙ‚Ø¯Ù… Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…Ø®ØµØµØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„</li>
            <li>ÙŠÙˆÙØ± Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø¨ÙŠØ¹ ÙˆØ§Ø¶Ø­Ø©</li>
            <li>ÙŠØ³ØªØ®Ø¯Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ©</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

<script>
// ===== Main Functions =====
async function postJson(url, body){
  const res = await fetch(url, { 
    method: 'POST', 
    headers: { 'Content-Type': 'application/json' }, 
    body: JSON.stringify(body)
  });
  return res.json();
}

const askBtn = document.getElementById('askBtn');
const clearBtn = document.getElementById('clearBtn');
const resultDiv = document.getElementById('result');
const sourcesDiv = document.getElementById('sources');
const questionInput = document.getElementById('question');

// Ask Button Handler
askBtn.addEventListener('click', async ()=>{
  const q = questionInput.value.trim();
  if(!q){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø³Ø¤Ø§Ù„'); return; }
  
  // Show loading
  askBtn.disabled = true;
  askBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...';
  resultDiv.style.display = 'block';
  resultDiv.innerHTML = '<div style="text-align:center;padding:20px">ğŸ¤– Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØ­Ù„Ù„ Ø³Ø¤Ø§Ù„Ùƒ...</div>';
  sourcesDiv.innerHTML = '';
  
  const industry = document.getElementById('industry').value;
  const scenario = document.getElementById('scenario').value;
  
  try{
    // ğŸ”¥ THIS IS THE KEY: use_gemini is TRUE
    const resp = await postJson('/ask', { 
      question: q, 
      industry, 
      scenario, 
      top_k: 6, 
      use_gemini: true  // âœ… AI ENABLED!
    });
    
    // Format and display answer
    resultDiv.innerHTML = formatMarkdown(resp.answer_ar || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø©');
    
    // Show AI badge if powered by AI
    if(resp.ai_powered) {
      sourcesDiv.innerHTML = `
        <div class="ai-powered">
          âœ¨ <strong>Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</strong> â€¢ 
          Ø§Ù„Ù†Ù…Ø·: ${resp.query_mode === 'pain-point' ? 'Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ù…Ø­Ø¯Ø¯Ø©' : 'Ø§Ø³ØªÙƒØ´Ø§Ù Ø¹Ø§Ù…'}
        </div>
      `;
    }
    
    // Show sources
    if(resp.sources && resp.sources.length > 0){
      sourcesDiv.innerHTML += `
        <div style="color:var(--muted);margin-top:10px">
          <strong>ğŸ“š Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:</strong><br/>
          ${resp.sources.map(s => `
            â€¢ ${s.file} (Ø¯Ø±Ø¬Ø© Ø§Ù„ØªØ·Ø§Ø¨Ù‚: ${(s.score*100).toFixed(1)}%)
          `).join('<br/>')}
        </div>
      `;
    }
  } catch(e){
    resultDiv.innerHTML = `<div style="color:#dc2626;padding:16px">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ${e.message}</div>`;
  } finally {
    askBtn.disabled = false;
    askBtn.textContent = 'ğŸ” Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„';
  }
});

// Clear Button
clearBtn.addEventListener('click', ()=> {
  questionInput.value = '';
  resultDiv.style.display = 'none';
  sourcesDiv.innerHTML = '';
});

// Example Questions
document.querySelectorAll('.example-btn').forEach(btn => {
  btn.addEventListener('click', ()=> {
    questionInput.value = btn.getAttribute('data-q');
    askBtn.click();
  });
});

// Allow Enter to submit (with Ctrl/Cmd)
questionInput.addEventListener('keydown', (e)=> {
  if((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
    askBtn.click();
  }
});

// ===== Simple Markdown Formatter =====
function formatMarkdown(text) {
  return text
    .replace(/^### (.+)$/gm, '<h3>$1</h3>')
    .replace(/^## (.+)$/gm, '<h2>$1</h2>')
    .replace(/^# (.+)$/gm, '<h1>$1</h1>')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/^- (.+)$/gm, '<li>$1</li>')
    .replace(/^(\d+)\. (.+)$/gm, '<li>$2</li>')
    .replace(/\n\n/g, '<br/><br/>')
    .replace(/\n/g, '<br/>');
}
</script>
</body>
</html>
