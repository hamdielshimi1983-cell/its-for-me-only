<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zoho QnA - e&</title>
  <style>
    :root{
      --primary:#0066cc;
      --accent:#ff7a59;
      --bg:#f5f7fb;
      --card:#ffffff;
      --muted:#6b7280;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family: "Tajawal", "Tahoma", Arial, sans-serif;background:var(--bg);color:#0b1220;line-height:1.5}
    .container{max-width:1100px;margin:28px auto;padding:18px}
    .top{display:flex;gap:18px;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:44px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 6px 20px rgba(10,20,40,0.06);padding:18px}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:12px;align-items:center}
    .btn{background:var(--primary);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent;color:var(--primary);border:1px solid rgba(0,102,204,0.12)}
    .layout{display:grid;grid-template-columns: 1fr 420px;gap:18px;margin-top:14px}
    @media(max-width:960px){.layout{grid-template-columns:1fr;}}
    label{display:block;font-weight:700;margin-top:10px}
    select,textarea,input{width:100%;padding:10px;border-radius:10px;border:1px solid #e8eef8;background:#fbfdff}
    textarea{min-height:110px;resize:vertical}
    .result{white-space:pre-wrap;margin-top:12px;background:#fcfeff;padding:12px;border-radius:10px;border:1px solid #eef6ff}
    .sources{margin-top:10px;color:var(--muted);font-size:13px}
    .ai-badge{display:inline-block;background:#16a34a;color:white;padding:4px 8px;border-radius:6px;font-size:11px;margin-left:8px}
  </style>
</head>
<body>
  <div class="container">
    <div class="top">
      <div class="brand">
        <img src="https://ik.imagekit.io/xtj3m9hth/image-remove1bg-preview%20(3).png?updatedAt=1761220721716" alt="e& logo">
        <img src="https://ik.imagekit.io/weo7pcw8v/image-removebg-preview%20(3).png?updatedAt=1761788895997" alt="Zoho logo" style="height:36px">
        <div>
          <h1>نظام دعم مبيعات Zoho — e& <span class="ai-badge">AI مفعّل</span></h1>
          <div style="color:var(--muted);font-size:13px;margin-top:4px">مساعد ذكي • إجابات شاملة بالعربية</div>
        </div>
      </div>
    </div>

    <div class="layout">
      <div>
        <div class="card">
          <label>اختر القطاع (اختياري)</label>
          <select id="industry">
            <option value="">عام / غير محدد</option>
            <option value="retail">التجزئة والتجارة الإلكترونية</option>
            <option value="logistics">الخدمات اللوجستية</option>
            <option value="fintech">التكنولوجيا المالية</option>
            <option value="tourism">السياحة والضيافة</option>
            <option value="realestate">العقارات والإنشاءات</option>
            <option value="health">الرعاية الصحية</option>
          </select>

          <label>نوع السؤال (اختياري)</label>
          <select id="scenario">
            <option value="">عام</option>
            <option value="discovery">اكتشاف</option>
            <option value="objection">اعتراض</option>
            <option value="value">قيمة المنتج</option>
            <option value="recommend">اختيار التطبيق</option>
            <option value="workflow">مشكلة تشغيلية</option>
            <option value="closing">إغلاق / لوجستيات</option>
          </select>

          <label>اكتب سؤال العميل أو مشكلته هنا</label>
          <textarea id="question" placeholder="مثال: لدي مشكلة في تتبع المخزون في متاجري"></textarea>

          <div style="display:flex;gap:10px;margin-top:12px;align-items:center">
            <button id="askBtn" class="btn">إرسال السؤال</button>
          </div>

          <div id="result" class="result" style="display:none"></div>
          <div id="sources" class="sources"></div>
        </div>
      </div>

      <div>
        <div class="card">
          <h3 style="margin:0 0 8px 0">أمثلة على الأسئلة</h3>
          <ul style="color:var(--muted);padding-left:18px">
            <li><strong>مشكلة محددة:</strong> "لدي مشكلة في تتبع المخزون"</li>
            <li><strong>استكشاف منتج:</strong> "ما هو Zoho CRM؟"</li>
            <li><strong>اعتراض:</strong> "العميل يقول النظام معقد"</li>
            <li><strong>مقارنة:</strong> "ما الفرق بين CRM و Books؟"</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

<script>
async function postJson(url, body){
  const res = await fetch(url, { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(body), credentials:'same-origin' });
  return res.json();
}

const askBtn = document.getElementById('askBtn');
const resultDiv = document.getElementById('result');
const sourcesDiv = document.getElementById('sources');

askBtn.addEventListener('click', async ()=>{
  const q = document.getElementById('question').value.trim();
  if(!q){ alert('الرجاء كتابة سؤال'); return; }
  
  resultDiv.style.display = 'block';
  resultDiv.textContent = 'جاري البحث والتحليل بواسطة الذكاء الاصطناعي...';
  sourcesDiv.textContent = '';
  
  const industry = document.getElementById('industry').value;
  const scenario = document.getElementById('scenario').value;
  
  try{
    // FIXED: Changed use_gemini to TRUE
    const resp = await postJson('/ask', { 
      question: q, 
      industry, 
      scenario, 
      top_k: 6, 
      use_gemini: true  // ✅ AI enabled!
    });
    
    resultDiv.innerHTML = formatMarkdown(resp.answer_ar || 'لا توجد إجابة');
    
    if(resp.ai_powered) {
      sourcesDiv.innerHTML = '<div style="background:#e0f2fe;padding:8px;border-radius:6px;margin-bottom:10px">✨ <strong>مدعوم بالذكاء الاصطناعي</strong></div>';
    }
    
    if(resp.sources && resp.sources.length>0){
      sourcesDiv.innerHTML += '<strong>المصادر:</strong><br/>' + 
        resp.sources.map(s=>`${s.file} - درجة التطابق: ${(s.score*100).toFixed(1)}%`).join('<br/>');
    }
  }catch(e){
    resultDiv.textContent = 'حدث خطأ: ' + e.message;
  }
});

// Simple markdown formatter
function formatMarkdown(text) {
  return text
    .replace(/^### (.+)$/gm, '<h3>$1</h3>')
    .replace(/^## (.+)$/gm, '<h2>$1</h2>')
    .replace(/^# (.+)$/gm, '<h1>$1</h1>')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\n/g, '<br/>');
}
</script>
</body>
</html>
